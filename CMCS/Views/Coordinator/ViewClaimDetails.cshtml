@model CMCS.Models.Claim
@{
    ViewData["Title"] = "Claim Details";
    var lecturer = ViewBag.Lecturer as CMCS.Models.Lecturer;
    var documents = ViewBag.Documents as List<CMCS.Models.Document>;
}

<div class="container mt-4">
    <h2 class="text-primary fw-bold mb-3">
        <i class="bi bi-file-earmark-text"></i> Claim Details
    </h2>

    <!-- Alerts -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show shadow-sm">
            <i class="bi bi-check-circle-fill"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show shadow-sm">
            <i class="bi bi-exclamation-triangle-fill"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Claim Summary -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-receipt"></i> Claim Information</h5>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-4 col-md-3">Claim ID:</dt>
                <dd class="col-sm-8 col-md-9">@Model.ClaimID</dd>

                <dt class="col-sm-4 col-md-3">Date Submitted:</dt>
                <dd class="col-sm-8 col-md-9">@Model.ClaimDate.ToShortDateString()</dd>

                <dt class="col-sm-4 col-md-3">Hours Worked:</dt>
                <dd class="col-sm-8 col-md-9">@Model.HoursWorked</dd>

                <dt class="col-sm-4 col-md-3">Hourly Rate:</dt>
                <dd class="col-sm-8 col-md-9">R @Model.HourlyRate.ToString("0.00")</dd>

                <dt class="col-sm-4 col-md-3">Total Amount:</dt>
                <dd class="col-sm-8 col-md-9 fw-bold text-success">
                    R @( ((decimal)Model.HoursWorked * Model.HourlyRate).ToString("0.00") )
                </dd>

                <dt class="col-sm-4 col-md-3">Status:</dt>
                <dd class="col-sm-8 col-md-9">
                    @if (Model.Status == "Pending")
                    {
                        <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split"></i> Pending</span>
                    }
                    else if (Model.Status == "Approved")
                    {
                        <span class="badge bg-success"><i class="bi bi-check-circle"></i> Approved</span>
                    }
                    else
                    {
                        <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Rejected</span>
                    }
                </dd>
            </dl>
        </div>
    </div>

    <!-- Lecturer Info -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="bi bi-person-badge"></i> Lecturer Information</h5>
        </div>
        <div class="card-body">
            @if (lecturer != null)
            {
                <dl class="row mb-0">
                    <dt class="col-sm-4 col-md-3">Name:</dt>
                    <dd class="col-sm-8 col-md-9">@lecturer.FirstName @lecturer.LastName</dd>

                    <dt class="col-sm-4 col-md-3">Email:</dt>
                    <dd class="col-sm-8 col-md-9">@lecturer.Email</dd>

                    <dt class="col-sm-4 col-md-3">Phone:</dt>
                    <dd class="col-sm-8 col-md-9">@lecturer.Phone</dd>

                    <dt class="col-sm-4 col-md-3">Staff Number:</dt>
                    <dd class="col-sm-8 col-md-9">@lecturer.StaffNumber</dd>
                </dl>
            }
            else
            {
                <p class="text-muted">Lecturer information not available.</p>
            }
        </div>
    </div>

    <!-- Supporting Documents -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-paperclip"></i> Supporting Documents</h5>
        </div>
        <div class="card-body">
            @if (documents != null && documents.Any())
            {
                <ul class="list-group list-group-flush">
                    @foreach (var doc in documents)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-file-earmark-text"></i> @doc.FileName
                                <small class="text-muted">(@doc.FileType)</small>
                                <br />
                                <small class="text-muted">Uploaded: @doc.UploadDate.ToString("yyyy-MM-dd HH:mm")</small>
                            </div>
                            <a href="@doc.FilePath" target="_blank" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-eye"></i> View
                            </a>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted">No supporting documents uploaded for this claim.</p>
            }
        </div>
    </div>

    <!-- Coordinator Approval Actions -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-person-check"></i> Coordinator Action</h5>
        </div>
        <div class="card-body">
            <form asp-action="UpdateClaimStatus" method="post" class="row g-3">
                <input type="hidden" name="claimId" value="@Model.ClaimID" />

                <div class="col-12">
                    <label class="form-label fw-semibold">Coordinator Comments</label>
                    <textarea name="comments" class="form-control" rows="3"
                              placeholder="Enter remarks or reasoning for approval/rejection..." required></textarea>
                </div>

                <div class="col-12 d-flex justify-content-end gap-2 mt-3">
                    <button type="submit" name="status" value="Approved" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> Approve
                    </button>
                    <button type="submit" name="status" value="Rejected" class="btn btn-danger">
                        <i class="bi bi-x-circle"></i> Reject
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    dl dt {
        font-weight: 600;
    }

    .card-header {
        font-size: 1rem;
    }

    .list-group-item {
        transition: background-color 0.2s;
    }

        .list-group-item:hover {
            background-color: #f2f8ff;
        }
</style>

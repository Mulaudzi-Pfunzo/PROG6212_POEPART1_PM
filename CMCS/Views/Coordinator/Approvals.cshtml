@{
    ViewData["Title"] = "Manage Approvals";
   
    var claims = Model as IEnumerable<dynamic>;
}

<div class="container mt-4">
    <h2 class="text-primary fw-bold mb-3">Manage Lecturer Claims</h2>

    <!-- Alert Messages -->
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Info"] != null)
    {
        <div class="alert alert-info">@TempData["Info"]</div>
    }

    <!-- Claims Table -->
    @if (claims != null && claims.Any())
    {
        <div class="table-responsive shadow-sm rounded">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Claim ID</th>
                        <th>Lecturer</th>
                        <th>Date Submitted</th>
                        <th>Hours</th>
                        <th>Amount (R)</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var claim in claims)
                    {
                        string badgeClass = claim.Status switch
                        {
                            "Approved" => "bg-success",
                            "Rejected" => "bg-danger",
                            "Pending" => "bg-warning text-dark",
                            _ => "bg-secondary"
                        };

                        <tr>
                            <td>@claim.ClaimID</td>
                            <td>@claim.LecturerName</td>
                            <td>@Convert.ToDateTime(claim.ClaimDate).ToShortDateString()</td>
                            <td>@claim.HoursWorked</td>

                            @* FIX: Cast HoursWorked to decimal before multiplication and format the output. *@
                            <td>R @(((decimal)claim.HoursWorked * claim.HourlyRate).ToString("N2"))</td>

                            <td><span class="badge @badgeClass">@claim.Status</span></td>
                            <td>
                                <a asp-action="ViewClaimDetails" asp-route-id="@claim.ClaimID"
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-eye"></i> Review
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No claims available at the moment.
        </div>
    }
</div>

<style>
    table th {
        font-weight: 600;
    }

    .badge {
        font-size: 0.85rem;
    }

    .btn-sm {
        font-size: 0.8rem;
        padding: 4px 10px;
    }

    .table-hover tbody tr:hover {
        background-color: #f2f8ff;
    }
</style>